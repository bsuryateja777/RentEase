version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Use Node 20
        - nvm install 20
        - nvm use 20
        # Go to client folder
        - cd client
        # Clean previous dependencies
        - rm -rf node_modules
        # Install all dependencies including devDependencies
        - npm install --include=dev --no-optional=false
    build:
      commands:
        # Build the project using local Vite
        - npx vite build
  artifacts:
    # Folder to deploy
    baseDirectory: client/dist
    files:
      - '**/*'
  cache:
    # Cache node_modules to speed up builds
    paths:
      - client/node_modules/**/*
  redirects:
    - source: </^[^.]+$/>
      target: /index.html
      status: 200